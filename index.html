<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="description" content="地圖">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>臺灣空氣品質地圖</title>
    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 5px;
            height: 90%;
            width: 99.3%;
        }

        button {
            width: 90px;
            height: 45px;
            font-size: 20px;
            margin-right: 5px;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.22/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.22/"></script>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/Basemap",
            "esri/layers/VectorTileLayer",
            "esri/layers/FeatureLayer",
            "esri/renderers/SimpleRenderer",
            "esri/symbols/SimpleMarkerSymbol",
            "esri/widgets/Legend"

        ], function (Map, MapView, Basemap, VectorTileLayer, FeatureLayer, SimpleRenderer, SimpleMarkerSymbol, Legend) {

            var basemap = new Basemap({
                baseLayers: [
                    new VectorTileLayer({
                        portalItem: {
                            id: "6976148c11bd497d8624206f9ee03e30"
                        }
                    })
                ]
            });

            var map = new Map({
                basemap: basemap
            });

            var view = new MapView({
                container: "viewDiv",
                map: map,
                center: [121, 23.6],
                zoom: 6
            });

            var layers = {
                PM25: new FeatureLayer({
                    url: "https://services7.arcgis.com/lBPc8U344JEzXGW0/arcgis/rest/services/%E7%A9%BA%E6%B0%A3%E5%93%81%E8%B3%AA%E5%9C%96/FeatureServer",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleMarkerSymbol({
                            size: 6,
                            color: [0, 0, 0]
                        }),
     visualVariables:[{
	type: "size",
	field: "pm2_5",
	stops: [
	 {value:0, size: 5},
	 {value:5, size: 10},
	 {value:10, size: 15},
	 {value:15, size: 20},
	 {value:20, size: 25},
	 {value:25, size: 30},
	 {value:30, size: 35},
	 {value:35, size: 40},
	 {value:40, size: 45},
	 {value:50, size: 55},
	 {value:60, size: 65},
	 {value:70, size: 75},
	 {value:80, size: 85},
	 {value:90, size: 95}]

	},
	{
	type: "color",
	field: "pm2_5",
	stops: [
	 {value:0, color: [195,195,195]},
	 {value:5, color: [180,180,180]},
	 {value:10, color: [165,165,165]},
	 {value:15, color: [150,150,150]},
	 {value:20, color: [135,135,135]},
	 {value:25, color: [120,120,120]},
	 {value:30, color: [105,105,105]},
	 {value:35, color: [90,90,90]},
	 {value:40, color: [75,75,75]},
	 {value:50, color: [60,60,60]},
	 {value:60, color: [45,45,45]},
	 {value:70, color: [30,30,30]},
	 {value:80, color: [15,15,15]},
	 {value:90, color: [0,0,0]}


                                ]
                            }
                        ]
                    })
                }),
              
 AQI: new FeatureLayer({
                    url: "https://services7.arcgis.com/lBPc8U344JEzXGW0/arcgis/rest/services/%E7%A9%BA%E6%B0%A3%E5%93%81%E8%B3%AA%E5%9C%96/FeatureServer",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleMarkerSymbol({
                            size: 6,
                            color: [0, 0, 0]
                        }),
     visualVariables:[{
	type: "size",
	field: "aqi",
	stops: [
	 {value:0, size: 5},
	 {value:5, size: 10},
	 {value:10, size: 15},
	 {value:15, size: 20},
	 {value:20, size: 25},
	 {value:25, size: 30},
	 {value:30, size: 35},
	 {value:35, size: 40},
	 {value:40, size: 45},
	 {value:50, size: 55},
	 {value:60, size: 65},
	 {value:70, size: 75},
	 {value:80, size: 85},
	 {value:90, size: 95}]

	},
	{
	type: "color",
	field: "aqi",
	stops: [
	 {value:0, color: [195,195,195]},
	 {value:5, color: [180,180,180]},
	 {value:10, color: [165,165,165]},
	 {value:15, color: [150,150,150]},
	 {value:20, color: [135,135,135]},
	 {value:25, color: [120,120,120]},
	 {value:30, color: [105,105,105]},
	 {value:35, color: [90,90,90]},
	 {value:40, color: [75,75,75]},
	 {value:50, color: [60,60,60]},
	 {value:60, color: [45,45,45]},
	 {value:70, color: [30,30,30]},
	 {value:80, color: [15,15,15]},
	 {value:90, color: [0,0,0]}


                                ]
                            }
                        ]
                    })
                }),


              
	O3:

new FeatureLayer({
                    url: "https://services7.arcgis.com/lBPc8U344JEzXGW0/arcgis/rest/services/%E7%A9%BA%E6%B0%A3%E5%93%81%E8%B3%AA%E5%9C%96/FeatureServer",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleMarkerSymbol({
                            size: 6,
                            color: [0, 0, 0]
                        }),
     visualVariables:[{
	type: "size",
	field: "o3",
	stops: [
	 {value:0, size: 5},
	 {value:5, size: 10},
	 {value:10, size: 15},
	 {value:15, size: 20},
	 {value:20, size: 25},
	 {value:25, size: 30},
	 {value:30, size: 35},
	 {value:35, size: 40},
	 {value:40, size: 45},
	 {value:50, size: 55},
	 {value:60, size: 65},
	 {value:70, size: 75},
	 {value:80, size: 85},
	 {value:90, size: 95}]

	},
	{
	type: "color",
	field: "o3",
	stops: [
	 {value:0, color: [195,195,195]},
	 {value:5, color: [180,180,180]},
	 {value:10, color: [165,165,165]},
	 {value:15, color: [150,150,150]},
	 {value:20, color: [135,135,135]},
	 {value:25, color: [120,120,120]},
	 {value:30, color: [105,105,105]},
	 {value:35, color: [90,90,90]},
	 {value:40, color: [75,75,75]},
	 {value:50, color: [60,60,60]},
	 {value:60, color: [45,45,45]},
	 {value:70, color: [30,30,30]},
	 {value:80, color: [15,15,15]},
	 {value:90, color: [0,0,0]}


                                ]
                            }
                        ]
                    })
                }),

                SO2: 

new FeatureLayer({
                    url: "https://services7.arcgis.com/lBPc8U344JEzXGW0/arcgis/rest/services/%E7%A9%BA%E6%B0%A3%E5%93%81%E8%B3%AA%E5%9C%96/FeatureServer",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleMarkerSymbol({
                            size: 6,
                            color: [0, 0, 0]
                        }),
     visualVariables:[{
	type: "size",
	field: "so2",
	stops: [
	 {value:0, size: 5},
	 {value:2, size: 10},
	 {value:4, size: 15},
	 {value:6, size: 20},
	 {value:8, size: 25},
	 {value:10, size: 30},
	 {value:12, size: 35},
	 {value:14, size: 40},
	 {value:16, size: 45},
	 {value:18, size: 55}]

	},
	{
	type: "color",
	field: "so2",
	stops: [
	 {value:0, color: [195,195,195]},
	 {value:2, color: [180,180,180]},
	 {value:4, color: [165,165,165]},
	 {value:6, color: [150,150,150]},
	 {value:8, color: [135,135,135]},
	 {value:10, color: [120,120,120]},
	 {value:12, color: [105,105,105]},
	 {value:14, color: [90,90,90]},
	 {value:16, color: [75,75,75]},
	 {value:18, color: [60,60,60]}

                                ]
                            }
                        ]
                    })
                }),
      

                NO: 
new FeatureLayer({
                    url: "https://services7.arcgis.com/lBPc8U344JEzXGW0/arcgis/rest/services/%E7%A9%BA%E6%B0%A3%E5%93%81%E8%B3%AA%E5%9C%96/FeatureServer",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleMarkerSymbol({
                            size: 6,
                            color: [0, 0, 0]
                        }),
     visualVariables:[{
	type: "size",
	field: "no",
	stops: [
	 {value:0, size: 5},
	 {value:5, size: 10},
	 {value:10, size: 15},
	 {value:15, size: 20},
	 {value:20, size: 25},
	 {value:25, size: 30},
	 {value:30, size: 35}
	 ]

	},
	{
	type: "color",
	field: "no",
	stops: [
	 {value:0, color: [180,180,180]},
	 {value:5, color: [150,150,150]},
	 {value:10, color: [120,120,120]},
	 {value:15, color: [90,90,90]},
	 {value:20, color: [60,60,60]},
	 {value:25, color: [30,30,30]},
	 {value:30, color: [0,0,0]}
         ]
                            }
                        ]
                    })
                }),
                NO2:
new FeatureLayer({
                    url: "https://services7.arcgis.com/lBPc8U344JEzXGW0/arcgis/rest/services/%E7%A9%BA%E6%B0%A3%E5%93%81%E8%B3%AA%E5%9C%96/FeatureServer",
                    renderer: new SimpleRenderer({
                        symbol: new SimpleMarkerSymbol({
                            size: 6,
                            color: [0, 0, 0]
                        }),
     visualVariables:[{
	type: "size",
	field: "no2",
	stops: [
	 {value:0, size: 5},
	 {value:5, size: 10},
	 {value:10, size: 15},
	 {value:15, size: 20},
	 {value:20, size: 25},
	 {value:25, size: 30},
	 {value:30, size: 35},
	 {value:35, size: 40}
	 ]

	},
	{
	type: "color",
	field: "no",
	stops: [
	 {value:0, color: [180,180,180]},
	 {value:5, color: [150,150,150]},
	 {value:10, color: [120,120,120]},
	 {value:15, color: [90,90,90]},
	 {value:20, color: [60,60,60]},
	 {value:25, color: [30,30,30]},
	 {value:30, color: [0,0,0]}
         ]
                            }
                        ]
                    })
                }),
            };

            var activeLayer = layers.PM25; // 預設顯示 PM2.5 圖層
            map.add(activeLayer);

            var legend = new Legend({
                view: view,
                layerInfos: [{
                    layer: activeLayer,
                    title: "pm2.5等級"
                }]
            });
            view.ui.add(legend, "bottom-right");

            // 按鈕點擊事件處理函數
            function onButtonClick(layerKey) {
                // 移除當前顯示的圖層
                map.remove(activeLayer);
                // 更新當前顯示的圖層
                activeLayer = layers[layerKey];
                // 將新的圖層添加到地圖
                map.add(activeLayer);
                // 更新圖例
                legend.layerInfos = [{
                    layer: activeLayer,
                    title: layerKey
                }];
            }

            // 綁定按鈕點擊
            document.getElementById("btnPM25").addEventListener("click", function () {
                onButtonClick("PM25");
            });

            document.getElementById("btnAQI").addEventListener("click", function () {
                onButtonClick("AQI");
            });

            document.getElementById("btnO3").addEventListener("click", function () {
                onButtonClick("O3");
            });

            document.getElementById("btnSO2").addEventListener("click", function () {
                onButtonClick("SO2");
            });


            document.getElementById("btnNO").addEventListener("click", function () {
                onButtonClick("NO");
            });

            document.getElementById("btnNO2").addEventListener("click", function () {
                onButtonClick("NO2");
            });
        });

    </script>
</head>

<body>
    <h2>臺灣空氣品質地圖</h2>
    <div id="viewDiv"></div>
    <h4>圖層Layers</h4>
    <div class="button-container">
        <button id="btnPM25">PM2.5</button>
        <button id="btnAQI">AQI</button>
        <button id="btnO3">O3</button>
        <button id="btnSO2">SO2</button>
        <button id="btnNO">NO</button>
        <button id="btnNO2">NO2</button>
    </div>
</body>

</html>
